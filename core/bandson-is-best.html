<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex, nofollow" />
    <title>Bandson is Best!!!</title>
    <link rel="icon" href="https://img.icons8.com/fluency/48/trumpet.png" />
    <style>
      html,
      body {
        margin: 0;
        width: 100%;
        height: 100%;
        font-family: Arial, Helvetica, sans-serif;
      }
      #dialogText {
        color: white;
        background-color: #333333;
      }

      #dialogWrap {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: table;
        background-color: #eeeeee;
      }

      #dialogWrapCell {
        display: table-cell;
        text-align: center;
        vertical-align: middle;
      }

      #mainDialog {
        max-width: 400px;
        margin: 5px;
        border: solid #aaaaaa 1px;
        border-radius: 10px;
        box-shadow: 3px 3px 5px 3px #aaaaaa;
        margin-left: auto;
        margin-right: auto;
        background-color: #ffffff;
        overflow: hidden;
        text-align: left;
      }
      #mainDialog > * {
        padding: 10px 30px;
      }
      #passArea {
        padding: 20px 30px;
        background-color: white;
      }
      #passArea > * {
        margin: 5px auto;
      }
      #pass {
        width: 100%;
        height: 40px;
        font-size: 30px;
      }

      #messageWrapper {
        float: left;
        vertical-align: middle;
        line-height: 30px;
      }

      .notifyText {
        display: none;
      }

      #invalidPass {
        color: red;
      }

      #success {
        color: green;
      }

      #submitPass {
        font-size: 20px;
        border-radius: 5px;
        background-color: #e7e7e7;
        border: solid gray 1px;
        float: right;
        cursor: pointer;
      }
      #contentFrame {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      #attribution {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        text-align: center;
        padding: 10px;
        font-weight: bold;
        font-size: 0.8em;
      }
      #attribution,
      #attribution a {
        color: #999;
      }
      .error {
        display: none;
        color: red;
      }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameborder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
      <div id="dialogWrapCell">
        <div id="mainDialog">
          <div id="dialogText">This page is password protected.</div>
          <div id="passArea">
            <p id="passwordPrompt">Password</p>
            <input id="pass" type="password" name="pass" autofocus />
            <div>
              <span id="messageWrapper">
                <span id="invalidPass" class="error"
                  >Sorry, please try again.</span
                >
                <span id="trycatcherror" class="error"
                  >Sorry, something went wrong.</span
                >
                <span id="success" class="notifyText">Success!</span>
                &nbsp;
              </span>
              <button id="submitPass" type="button">Submit</button>
              <div style="clear: both"></div>
            </div>
          </div>
          <div id="securecontext" class="error">
            <p>
              Sorry, but password protection only works over a secure
              connection. Please load this page via HTTPS.
            </p>
          </div>
          <div id="nocrypto" class="error">
            <p>
              Your web browser appears to be outdated. Please visit this page
              using a modern browser.
            </p>
          </div>
        </div>
      </div>
    </div>
    <script>
      (function () {
        var pl =
          "sZNf6I8fLD3KehwiFFig28t1r+hlNS6nqZMY+csmLsg1M7nN12fQmpa/1XOwi4fJ8MJ3nzK+XzhV6xg8a5DnXbQpwqdJ5zj3m1+axITSjeo5exVUdY6z56C0m0jU1y7VkXuoXSUTIkAXi6xder94ra2qI69Ic8QnSGS8NpSum9Q0tkhutZSRF5Inw+/TnnT/TLhj7hGkJHk7wVMo1tR1WUJAN6KtLi2J1pFrUmm+4KukjPqbF7mtdskpi+ZpMLDqAts/3ySx+Ezt78M7Uf6giZbix9mvgLWrtApe4DgD17xfY4QROfWySWrhvvWl6IHtBo8HgGPLNJY/CV2K09C8KFZ5Ow1eChUYYmvKpZ2ZC7f59N6M3XxXAxSU9YKrqGWMBLhbhLiIN3GKn5NeIm6rR/CbG+ie3OupZMMJGy5tL/RK7E10dZvEYiMxVmzgv+IOy5y2Ir/zb5tL38Rh/538n2eNaCABtB4FdtDE2CBQKHNbYHUFsTKoRlIv7ASemoJY/KP1hXZmfw0OZ1M6ioML4jXMhcJBr0nm78UQOSf73hoLpChq7ptyzAs7di1e1w5omr0cnMvfgvR1J2Yj9u2kWX/4lPdXy2Wi4VbWvI4eKmrKaVwUNcu3D2rUa4T9EQbi73U4HAH4jF0yYSTcutVcuBvOYWLkbqoLX58HM9baNFp9OWYV9K4Nf6oJ4e3g9EZjbe3hna6LxltUhlKk/O+5k5oF7gi3GR4KRJZJeNSl0oKcQBNFOvp4I2G1cGqqgiS739ZORWabSPxwRG3HiF/n5IM7dX+RhKhbvwNGKSRWhIb5c24QJ4XPUwAGK36FavggfBLW5A/uJLejzQGkfaT/Zcr//q7rhzYynMjqxkYmOasdzoClEmixfwb9DjLi5dXvxDE4mj9/3qwVKUGat4Uq8wC/CQC+rOmlGv6zRUGFl5GqCfIUctbc/e3EDnmGDvQ3OmB4WNIBVaRzQahhaxPspz/9tk3SzuPWs4EpDydN6aEEFrrGi5As8uQo+lPyGPHIZic0JL9GGoNbujumGp5q9dvmfBkaTFisIhRCpt2rdOo/zSIsufSc7RTB+a/fUWpLqw81f+9t/rrm3M1HzVrxT3KKHlUAwyOtWhLOCXwsKDP5RAlQmkWgQxWTduQjtCCDSA4XbuMI3QhRFtdulBltRO2aiWkn7uTncwgQkZXjmbI3Mo/LG1D2IVloAqohbv2tCfeBISwnnjaOMOmNED7DR4E3F7VHAD4pwZXtIgLY4C2vVjxT3H5B/bFtSL70rE7CxN/r6SfjDiFEjDibNDhuyGMl2HBZWe1GnR9iV5HI2IkND0ZJzpApMTL6yju+hY3JsaLCNmfHxVw1G3zjFj/z//7FcwGQH0X5bEnjlVPVQEB3ZZ1LYL7x9SO+xH0Yb3XIBejtWorDUb0XB6R58+ZUH86BpKAGD5u2/tOjy/oPxVc75rX+xGxm2+hKEnNMGO2Bm1yiK6VoJ0YdUkdP9CGPlgnSk6lBipaaMHu+ebeUY3SNnEM1uEQhZBt4txMKz6Ns+Pkdzpoea2G5aNHQ0DDC+gDK3XrdwDXt2RvZKfpXTYlUn3GE0+j433WoEdSw1NVZRQheVyoApf5+reGPjVP2/zyU0k5cy8PX+jkV0zwqHvOQ/cIaxj2qFDJ/DxqxnHAGSacHB0GP/6j9bkG6aieHFHZ/AgUAcLzuQbhEGwP5jij0PthwuCj+B/7Wd3E1wFWOLD6K/b17TYGQyMwvsrk87zbWial39uXddkD+0fXrykw6KSOoK3d2vC3kh5iPt45XGkMpSjSJPprVtUKydW4Nfpqzunq9db2yzoNnvF/2v76HhNurKTc0sJWavaBRi3rzHrn1qFu1pE4GOPZB/bkB";

        var submitPass = document.getElementById("submitPass");
        var passEl = document.getElementById("pass");
        var invalidPassEl = document.getElementById("invalidPass");
        var trycatcherror = document.getElementById("trycatcherror");
        var successEl = document.getElementById("success");
        var contentFrame = document.getElementById("contentFrame");

        // Sanity checks

        if (pl === "") {
          submitPass.disabled = true;
          passEl.disabled = true;
          alert(
            "This page is meant to be used with the encryption tool. It doesn't work standalone."
          );
          return;
        }

        if (!isSecureContext) {
          document.querySelector("#passArea").style.display = "none";
          document.querySelector("#securecontext").style.display = "block";
          return;
        }

        if (!crypto.subtle) {
          document.querySelector("#passArea").style.display = "none";
          document.querySelector("#nocrypto").style.display = "block";
          return;
        }

        function str2ab(str) {
          var ustr = atob(str);
          var buf = new ArrayBuffer(ustr.length);
          var bufView = new Uint8Array(buf);
          for (var i = 0, strLen = ustr.length; i < strLen; i++) {
            bufView[i] = ustr.charCodeAt(i);
          }
          return bufView;
        }

        async function deriveKey(salt, password) {
          const encoder = new TextEncoder();
          const baseKey = await crypto.subtle.importKey(
            "raw",
            encoder.encode(password),
            "PBKDF2",
            false,
            ["deriveKey"]
          );
          return await crypto.subtle.deriveKey(
            { name: "PBKDF2", salt, iterations: 100000, hash: "SHA-256" },
            baseKey,
            { name: "AES-GCM", length: 256 },
            true,
            ["decrypt"]
          );
        }

        async function doSubmit(evt) {
          submitPass.disabled = true;
          passEl.disabled = true;

          let iv, ciphertext, key;

          try {
            var unencodedPl = str2ab(pl);

            const salt = unencodedPl.slice(0, 32);
            iv = unencodedPl.slice(32, 32 + 16);
            ciphertext = unencodedPl.slice(32 + 16);

            key = await deriveKey(salt, passEl.value);
          } catch (e) {
            trycatcherror.style.display = "inline";
            console.error(e);
            return;
          }

          try {
            const decryptedArray = new Uint8Array(
              await crypto.subtle.decrypt(
                { name: "AES-GCM", iv },
                key,
                ciphertext
              )
            );

            let decrypted = new TextDecoder().decode(decryptedArray);

            if (decrypted === "") throw "No data returned";

            const basestr = '<base href="." target="_top">';
            const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;

            // Set default iframe link targets to _top so all links break out of the iframe
            if (decrypted.includes("<head>"))
              decrypted = decrypted.replace("<head>", "<head>" + basestr);
            else if (decrypted.includes("<!DOCTYPE html>"))
              decrypted = decrypted.replace(
                "<!DOCTYPE html>",
                "<!DOCTYPE html>" + basestr
              );
            else decrypted = basestr + decrypted;

            // Fix fragment links
            if (decrypted.includes("</body>"))
              decrypted = decrypted.replace(
                "</body>",
                anchorfixstr + "</body>"
              );
            else if (decrypted.includes("</html>"))
              decrypted = decrypted.replace(
                "</html>",
                anchorfixstr + "</html>"
              );
            else decrypted = decrypted + anchorfixstr;

            contentFrame.srcdoc = decrypted;

            successEl.style.display = "inline";
            setTimeout(function () {
              dialogWrap.style.display = "none";
            }, 1000);
          } catch (e) {
            invalidPassEl.style.display = "inline";
            passEl.value = "";
            submitPass.disabled = false;
            passEl.disabled = false;
            console.error(e);
            return;
          }
        }

        submitPass.onclick = doSubmit;
        passEl.onkeypress = function (e) {
          if (!e) e = window.event;
          var keyCode = e.keyCode || e.which;
          invalidPassEl.style.display = "none";
          if (keyCode == "13") {
            // Enter pressed
            doSubmit();
            return false;
          }
        };
      })();
    </script>
  </body>
</html>
